<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Chet</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üíÄ</text></svg>" id="favicon">
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;height:100vh;overflow:hidden;background:#36393f}
.container{display:flex;height:100vh}
.sidebar{width:240px;background:#2f3136;display:flex;flex-direction:column}
.sidebar.right{order:3;border-left:1px solid #202225;transition:transform .3s}
.sidebar.right.collapsed{transform:translateX(240px)}
.right-toggle{position:absolute;left:-36px;top:50%;transform:translateY(-50%);background:#2f3136;border:1px solid #202225;border-right:none;padding:8px;border-radius:4px 0 0 4px;cursor:pointer;color:#96989d;transition:color .2s}
.right-toggle:hover{color:#fff}
.server-header{height:48px;padding:0 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #202225;color:#fff;font-weight:600;font-size:15px}
.channels{flex:1;overflow-y:auto;padding:8px}
.channel-section{margin-bottom:16px}
.section-header{color:#96989d;font-size:12px;font-weight:600;text-transform:uppercase;margin-bottom:4px;padding:0 8px;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
.channel{padding:8px 12px;margin:2px 0;border-radius:4px;color:#96989d;cursor:pointer;display:flex;align-items:center;justify-content:space-between;font-size:14px;transition:all .15s;position:relative}
.channel:hover{background:#3a3c42;color:#dcddde}
.channel.active{background:#404249;color:#fff}
.channel.has-unread{font-weight:600}
.channel-name{display:flex;align-items:center}
.channel-name::before{content:'#';margin-right:6px;font-weight:600;color:#72767d}
.channel.private .channel-name::before{content:'@';color:#5865f2}
.unread-badge{background:#ed4245;color:#fff;border-radius:10px;padding:2px 6px;font-size:10px;font-weight:700;min-width:18px;text-align:center;display:none}
.channel.has-unread .unread-badge{display:block}
.dm-badge{position:absolute;right:8px;top:50%;transform:translateY(-50%);background:#ed4245;color:#fff;border-radius:10px;padding:2px 6px;font-size:10px;font-weight:700;min-width:18px;text-align:center}
.close-dm{opacity:0;background:none;border:none;color:#96989d;cursor:pointer;font-size:16px;transition:opacity .2s}
.channel:hover .close-dm{opacity:1}
.close-dm:hover{color:#ed4245}
.users-section{flex:1;overflow-y:auto;padding:8px}
.users-section-header{padding:8px 12px;color:#96989d;font-size:12px;font-weight:600;display:flex;justify-content:space-between;align-items:center}
.online-count{color:#3ba55d;font-size:11px}
.role-header{font-size:11px;font-weight:600;text-transform:uppercase;padding:8px 12px 4px}
.owner-header{color:#e74c3c}
.admin-header{color:#faa61a}
.vip-header{color:#f47fff}
.guest-header{color:#96989d}
.user-item{padding:6px 12px;color:#dcddde;font-size:13px;display:flex;align-items:center;justify-content:space-between;border-radius:4px;margin:0 4px;transition:background .15s;cursor:pointer}
.user-item:hover{background:#3a3c42}
.user-name{display:flex;align-items:center;gap:6px}
.user-name::before{content:'‚óè';color:#3ba55d;font-size:8px}
.role-badge{font-size:9px;font-weight:700;padding:2px 5px;border-radius:3px;color:#fff;margin-left:4px}
.role-badge.owner{background:linear-gradient(135deg,#e74c3c,#c0392b)}
.role-badge.admin{background:linear-gradient(135deg,#faa61a,#ff8c00)}
.role-badge.vip{background:linear-gradient(135deg,#f47fff,#ff6ec7)}
.dm-btn{opacity:0;background:#5865f2;color:#fff;border:none;padding:3px 8px;border-radius:3px;font-size:10px;cursor:pointer;transition:opacity .2s}
.user-item:hover .dm-btn{opacity:1}
.user-area{height:52px;background:#292b2f;padding:0 8px;display:flex;align-items:center;cursor:pointer;transition:background .2s;position:relative}
.user-area:hover{background:#2a2d31}
.user-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;margin-right:8px;font-size:14px;position:relative}
.notif-dot{position:absolute;top:-2px;right:-2px;width:12px;height:12px;background:#ed4245;border:2px solid #292b2f;border-radius:50%;animation:pulse 2s infinite;display:none}
.notif-dot.show{display:block}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
.avatar-badge{position:absolute;bottom:-2px;right:-2px;width:14px;height:14px;border-radius:50%;display:none;align-items:center;justify-content:center;font-size:7px;border:2px solid #292b2f;color:#fff}
.avatar-badge.show{display:flex}
.avatar-badge.owner{background:#e74c3c}
.avatar-badge.admin{background:#faa61a}
.avatar-badge.vip{background:#f47fff}
.user-display-name{color:#fff;font-size:14px;font-weight:500}
.conn-status{width:8px;height:8px;border-radius:50%;background:#ed4245;margin-left:auto;transition:background .3s}
.conn-status.online{background:#3ba55d}
.main-content{flex:1;display:flex;flex-direction:column;background:#36393f}
.chat-header{height:48px;padding:0 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #202225;color:#fff}
.current-channel{font-weight:600;font-size:16px}
.current-channel::before{content:'#';margin-right:4px;color:#72767d}
.current-channel.private::before{content:'@';color:#5865f2}
.header-actions{display:flex;align-items:center;gap:12px}
.casino-btn{background:linear-gradient(135deg,#f093fb,#f5576c);color:#fff;border:none;padding:8px 16px;border-radius:8px;cursor:pointer;font-weight:600;font-size:14px;transition:transform .2s,box-shadow .2s}
.casino-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(240,147,251,.4)}
.coins-display{background:#40444b;padding:6px 12px;border-radius:8px;font-weight:600;font-size:14px;display:flex;align-items:center;gap:6px;transition:all .3s}
.coins-display.peace{background:#3ba55d;box-shadow:0 0 12px rgba(59,165,93,.3)}
.messages{flex:1;overflow-y:auto;padding:16px}
.message{display:flex;padding:4px 0;margin-bottom:8px;position:relative;transition:background .15s}
.message:hover{background:rgba(0,0,0,.1);margin-left:-16px;margin-right:-16px;padding-left:16px;padding-right:16px;border-radius:4px}
.msg-avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;margin-right:16px;flex-shrink:0}
.msg-content{flex:1;min-width:0}
.msg-header{display:flex;align-items:center;gap:6px;margin-bottom:2px;flex-wrap:wrap}
.msg-author{font-weight:500;font-size:15px}
.msg-author.owner{color:#e74c3c}
.msg-author.admin{color:#faa61a}
.msg-author.vip{color:#f47fff}
.msg-author.normal{color:#fff}
.msg-time{color:#72767d;font-size:12px}
.msg-text{color:#dcddde;font-size:15px;line-height:1.4;word-wrap:break-word;white-space:pre-wrap}
.msg-reply{background:#2f3136;border-left:3px solid #5865f2;padding:4px 8px;margin-bottom:4px;border-radius:0 4px 4px 0;font-size:13px;color:#96989d}
.msg-reply-author{color:#5865f2;font-weight:500}
.msg-actions{position:absolute;right:8px;top:-8px;background:#2f3136;border-radius:4px;display:none;box-shadow:0 2px 8px rgba(0,0,0,.4)}
.message:hover .msg-actions{display:flex}
.msg-action{background:none;border:none;color:#96989d;padding:6px 8px;cursor:pointer;font-size:14px;transition:all .15s}
.msg-action:hover{color:#fff;background:#3a3c42}
.reactions{display:flex;flex-wrap:wrap;gap:4px;margin-top:4px}
.reaction{background:#3a3c42;border:1px solid transparent;border-radius:6px;padding:2px 6px;font-size:14px;cursor:pointer;display:flex;align-items:center;gap:4px;transition:all .15s}
.reaction:hover{border-color:#5865f2;transform:scale(1.05)}
.reaction.active{background:rgba(88,101,242,.3);border-color:#5865f2}
.reaction-count{font-size:12px;color:#dcddde}
.emoji-picker{position:absolute;bottom:100%;right:0;background:#2f3136;border-radius:8px;padding:8px;display:none;box-shadow:0 4px 12px rgba(0,0,0,.5);z-index:100;animation:fadeIn .2s}
.emoji-picker.show{display:grid;grid-template-columns:repeat(5,1fr);gap:4px}
.emoji-picker button{background:none;border:none;font-size:20px;cursor:pointer;padding:4px;border-radius:4px;transition:all .15s}
.emoji-picker button:hover{background:#3a3c42;transform:scale(1.2)}
.input-area{padding:0 16px 16px}
.typing-indicator{height:24px;font-size:12px;color:#72767d;font-style:italic;display:flex;align-items:center}
.reply-bar{background:#40444b;border-radius:8px 8px 0 0;padding:8px 12px;display:none;align-items:center;justify-content:space-between}
.reply-bar.show{display:flex}
.reply-bar-text{color:#dcddde;font-size:13px}
.reply-bar-close{background:none;border:none;color:#96989d;cursor:pointer;font-size:18px;transition:color .2s}
.reply-bar-close:hover{color:#fff}
.input-wrapper{background:#40444b;border-radius:8px;padding:12px;display:flex;align-items:center}
.reply-bar.show+.input-wrapper{border-radius:0 0 8px 8px}
.msg-input{flex:1;background:none;border:none;color:#dcddde;font-size:15px;outline:none}
.msg-input::placeholder{color:#72767d}
.send-btn{background:#5865f2;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-weight:500;margin-left:8px;transition:background .2s}
.send-btn:hover{background:#4752c4}
.send-btn:disabled{background:#4e5058;cursor:not-allowed}
.notifs{position:fixed;top:16px;right:16px;z-index:1000;display:flex;flex-direction:column;gap:8px;max-width:380px;pointer-events:none}
.notifs>*{pointer-events:all}
.notif{background:#2f3136;border:1px solid #202225;border-radius:8px;padding:12px;box-shadow:0 4px 12px rgba(0,0,0,.4);animation:slideIn .3s}
@keyframes slideIn{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
.notif-title{color:#fff;font-weight:600;font-size:14px;margin-bottom:6px}
.notif-body{color:#dcddde;font-size:13px;margin-bottom:8px}
.notif-actions{display:flex;gap:8px}
.notif-btn{flex:1;padding:8px;border:none;border-radius:4px;font-weight:500;cursor:pointer;font-size:13px;transition:all .2s}
.notif-accept{background:#3ba55d;color:#fff}
.notif-accept:hover{background:#2d8659}
.notif-decline{background:#ed4245;color:#fff}
.notif-decline:hover{background:#c93b3e}
::-webkit-scrollbar{width:8px}
::-webkit-scrollbar-track{background:#2f3136}
::-webkit-scrollbar-thumb{background:#202225;border-radius:4px}
::-webkit-scrollbar-thumb:hover{background:#1a1c1f}
#loginOverlay{position:fixed;inset:0;z-index:2000;background:linear-gradient(135deg,#1a1c20 0%,#2f3136 50%,#1a1c20 100%);display:flex;align-items:center;justify-content:center;flex-direction:column}
.login-title{font-family:'Great Vibes',cursive;font-size:72px;color:#fff;margin-bottom:30px;text-shadow:0 0 20px rgba(88,101,242,.5),0 0 40px rgba(88,101,242,.3);animation:glow 2s ease-in-out infinite}
@keyframes glow{0%,100%{text-shadow:0 0 20px rgba(88,101,242,.5),0 0 40px rgba(88,101,242,.3)}50%{text-shadow:0 0 30px rgba(88,101,242,.7),0 0 60px rgba(88,101,242,.5)}}
#loginCard{width:320px;background:#2f3136;border:1px solid #202225;border-radius:8px;padding:24px;color:#fff;text-align:center;box-shadow:0 8px 24px rgba(0,0,0,.3)}
#loginCard h2{margin-bottom:16px;font-size:20px}
#pwdInput{width:100%;padding:12px;border-radius:6px;border:none;background:#40444b;color:#fff;font-size:14px;transition:box-shadow .2s}
#pwdInput:focus{outline:none;box-shadow:0 0 0 2px #5865f2}
#loginBtn{width:100%;margin-top:12px;padding:12px;border:none;border-radius:6px;background:#5865f2;color:#fff;cursor:pointer;font-weight:600;font-size:14px;transition:background .2s}
#loginBtn:hover{background:#4752c4}
.guest-login{margin-top:16px;color:#5865f2;font-size:13px;cursor:pointer;transition:all .2s;text-decoration:underline;text-underline-offset:2px}
.guest-login:hover{color:#7289da;transform:translateY(-1px)}
#loginError{margin-top:10px;color:#ed4245;font-size:13px;min-height:20px}
.empty{text-align:center;color:#72767d;padding:12px;font-size:12px}
.modal-overlay{position:fixed;inset:0;z-index:1500;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center}
.modal-overlay.show{display:flex}
.modal{width:520px;max-height:80vh;background:#2f3136;border-radius:8px;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 8px 32px rgba(0,0,0,.5)}
.modal-header{padding:16px;background:linear-gradient(135deg,#f093fb,#f5576c);color:#fff;display:flex;justify-content:space-between;align-items:center}
.modal-title{font-size:18px;font-weight:700}
.modal-close{background:rgba(255,255,255,.2);border:none;color:#fff;font-size:18px;cursor:pointer;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background .2s}
.modal-close:hover{background:rgba(255,255,255,.3)}
.modal-body{padding:16px;overflow-y:auto;flex:1}
.section{margin-bottom:16px}
.section-title{font-size:13px;font-weight:600;color:#fff;margin-bottom:8px}
.help-command{background:#40444b;padding:10px;border-radius:6px;margin-bottom:8px;border-left:3px solid #5865f2}
.help-command-name{color:#5865f2;font-weight:600;font-size:14px;margin-bottom:4px}
.help-command-desc{color:#dcddde;font-size:12px}
.leaderboard{background:#40444b;border-radius:6px;padding:8px}
.lb-item{display:flex;align-items:center;padding:6px 8px;background:#2f3136;border-radius:4px;margin-bottom:4px;transition:background .15s}
.lb-item:hover{background:#36393f}
.lb-rank{color:#faa61a;font-weight:700;width:24px}
.lb-name{color:#fff;flex:1}
.lb-coins{color:#3ba55d;font-weight:600}
.game-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.game-card{background:#40444b;padding:16px;border-radius:8px;text-align:center;cursor:pointer;border:2px solid transparent;transition:all .2s}
.game-card:hover{border-color:#5865f2;transform:translateY(-2px)}
.game-card.selected{border-color:#3ba55d;background:rgba(59,165,93,.15)}
.game-icon{font-size:32px;margin-bottom:6px}
.game-name{color:#fff;font-weight:600;font-size:13px}
.choice-btns{display:flex;gap:8px;margin-top:8px}
.choice-btn{flex:1;padding:10px;background:#40444b;border:2px solid transparent;border-radius:6px;color:#fff;cursor:pointer;font-weight:600;font-size:13px;transition:all .2s}
.choice-btn:hover{border-color:#5865f2;transform:scale(1.02)}
.choice-btn.selected{border-color:#3ba55d;background:rgba(59,165,93,.2)}
.form-group{margin-bottom:12px}
.form-label{color:#96989d;font-size:11px;font-weight:600;margin-bottom:4px;display:block}
.form-input,.form-select{width:100%;padding:10px;background:#40444b;border:1px solid #202225;border-radius:4px;color:#fff;font-size:13px;transition:border-color .2s}
.form-input:focus,.form-select:focus{border-color:#5865f2;outline:none}
.btn{width:100%;padding:10px;border:none;border-radius:4px;font-weight:600;cursor:pointer;font-size:13px;margin-top:8px;transition:all .2s}
.btn-primary{background:#5865f2;color:#fff}
.btn-primary:hover{background:#4752c4}
.btn-success{background:#3ba55d;color:#fff}
.btn-success:hover{background:#2d8659}
.btn-danger{background:#ed4245;color:#fff}
.btn-danger:hover{background:#c93b3e}
#gameScreen{position:fixed;inset:0;z-index:1600;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
#gameScreen.show{display:flex}
.game-modal{background:#2f3136;border-radius:12px;padding:32px;text-align:center;min-width:360px;box-shadow:0 12px 48px rgba(0,0,0,.6)}
.game-vs{font-size:24px;color:#fff;font-weight:700;margin-bottom:12px}
.game-wager{font-size:16px;color:#faa61a;font-weight:600;margin-bottom:20px}
.game-anim{font-size:64px;margin:20px 0;min-height:80px}
.game-ready-btn{padding:12px 32px;background:#5865f2;color:#fff;border:none;border-radius:8px;font-weight:600;font-size:16px;cursor:pointer;transition:all .2s}
.game-ready-btn:hover{background:#4752c4;transform:scale(1.05)}
.game-result{font-size:18px;font-weight:700;margin-top:16px}
.game-result.win{color:#3ba55d}
.game-result.lose{color:#ed4245}
#adminPanel{position:fixed;bottom:60px;left:8px;width:500px;max-height:500px;background:#2f3136;border:1px solid #202225;border-radius:8px;display:none;flex-direction:column;z-index:999;box-shadow:0 8px 24px rgba(0,0,0,.5);overflow:hidden}
#adminPanel.show{display:flex}
.ap-header{padding:12px 16px;border-bottom:1px solid #202225;display:flex;justify-content:space-between;align-items:center;flex-shrink:0}
.ap-title{color:#fff;font-weight:600;font-size:14px}
.ap-close{background:none;border:none;color:#96989d;cursor:pointer;font-size:20px;transition:color .2s}
.ap-close:hover{color:#fff}
.ap-tabs{display:flex;padding:8px;gap:6px;border-bottom:1px solid #202225;flex-wrap:wrap;flex-shrink:0;background:#26282d}
.ap-tab{padding:8px 12px;background:none;border:none;color:#96989d;cursor:pointer;border-radius:4px;font-size:11px;font-weight:600;transition:all .15s}
.ap-tab:hover{background:#3a3c42;color:#dcddde}
.ap-tab.active{background:#5865f2;color:#fff}
.ap-content{flex:1;overflow-y:auto;padding:12px;min-height:0}
.ap-section{display:none}
.ap-section.active{display:block}
.ap-user{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;background:#40444b;border-radius:6px;margin-bottom:6px;transition:background .15s}
.ap-user:hover{background:#474b52}
.ap-user-info{display:flex;align-items:center;gap:8px;min-width:0;flex:1}
.ap-user-avatar{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;color:#fff;font-size:12px;font-weight:600;flex-shrink:0}
.ap-user-name{color:#fff;font-size:12px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.ap-user-actions{display:flex;gap:4px;flex-shrink:0}
.ap-btn{padding:5px 9px;border:none;border-radius:3px;cursor:pointer;font-size:10px;font-weight:600;color:#fff;transition:opacity .2s}
.ap-btn:hover{opacity:.8}
.ap-btn-kick{background:#faa61a}
.ap-btn-to{background:#f47b67}
.ap-btn-mute{background:#9b59b6}
.ap-btn-ban{background:#ed4245}
.troll-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-bottom:10px}
.troll-btn{padding:8px 5px;border:none;border-radius:4px;cursor:pointer;font-size:10px;font-weight:600;color:#fff;background:#5865f2;transition:all .2s}
.troll-btn:hover{opacity:.9;transform:scale(1.02)}
.troll-btn.warn{background:#faa61a}
.troll-btn.danger{background:#ed4245}
.troll-btn.success{background:#3ba55d}
.owner-section{margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid #202225}
.owner-section:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}
.owner-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.owner-btn{padding:8px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:600;cursor:pointer;font-size:10px;transition:all .2s}
.owner-btn:hover{background:#c0392b;transform:scale(1.02)}
.ban-list{max-height:120px;overflow-y:auto;background:#40444b;border-radius:4px;padding:8px;margin-bottom:8px}
.ban-item{display:flex;justify-content:space-between;align-items:center;padding:5px 8px;background:#2f3136;border-radius:3px;margin-bottom:4px;font-size:11px;color:#dcddde}
.unban-btn{background:#3ba55d;color:#fff;border:none;padding:4px 8px;border-radius:3px;font-size:9px;cursor:pointer;transition:background .2s;font-weight:600}
.unban-btn:hover{background:#2d8659}
.ban-type-selector{display:flex;gap:6px;margin-top:8px}
.ban-type-btn{flex:1;padding:6px;background:#40444b;border:2px solid transparent;border-radius:4px;color:#fff;cursor:pointer;font-size:11px;font-weight:600;transition:all .2s;text-align:center}
.ban-type-btn:hover{border-color:#5865f2}
.ban-type-btn.selected{border-color:#3ba55d;background:rgba(59,165,93,.2)}
@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}
@keyframes rainbow{0%{filter:hue-rotate(0)}100%{filter:hue-rotate(360deg)}}
.confetti{position:fixed;width:10px;height:10px;pointer-events:none;z-index:9999;animation:fall 3s linear forwards}
@keyframes fall{to{transform:translateY(100vh) rotate(720deg);opacity:0}}
</style>
</head>
<body>
<div id="loginOverlay">
<div class="login-title">The Chet</div>
<div id="loginCard">
<h2>Enter Password</h2>
<input type="password" id="pwdInput" placeholder="Password">
<button id="loginBtn">Login</button>
<div class="guest-login" id="guestLogin">or continue as Guest</div>
<div id="loginError"></div>
</div>
</div>
<div class="notifs" id="notifs"></div>
<div class="modal-overlay" id="helpModal"><div class="modal"><div class="modal-header"><div class="modal-title">üìã Commands Help</div><button class="modal-close" id="closeHelp">√ó</button></div><div class="modal-body" id="helpContent"></div></div></div>
<div class="modal-overlay" id="casinoModal"><div class="modal"><div class="modal-header"><div class="modal-title">üé∞ Casino</div><button class="modal-close" id="closeCasino">√ó</button></div><div class="modal-body"><div class="section"><div class="section-title">üèÜ Leaderboard</div><div class="leaderboard" id="leaderboard"></div></div><div class="section"><div class="section-title">Choose Game</div><div class="game-grid"><div class="game-card" data-game="coinflip"><div class="game-icon">ü™ô</div><div class="game-name">Coin Flip</div></div><div class="game-card" data-game="dice"><div class="game-icon">üé≤</div><div class="game-name">Dice Roll</div></div></div><div id="choiceArea" style="display:none"><div class="section-title" style="margin-top:12px">Your Choice</div><div class="choice-btns" id="choiceBtns"></div></div></div><div class="section"><div class="section-title">Challenge Player</div><div class="form-group"><select class="form-select" id="challengeTarget"></select></div><div class="form-group"><input type="number" class="form-input" id="wagerAmt" placeholder="Wager amount" min="1"></div><button class="btn btn-success" id="sendChallengeBtn">‚öîÔ∏è Send Challenge</button></div></div></div></div>
<div id="gameScreen"><div class="game-modal"><div class="game-vs" id="gameVs"></div><div class="game-wager" id="gameWager"></div><div class="game-anim" id="gameAnim">üé≤</div><button class="game-ready-btn" id="readyBtn">I'm Ready!</button><div class="game-result" id="gameResult"></div></div></div>
<div id="adminPanel"><div class="ap-header"><div class="ap-title">‚ö° Admin Panel</div><button class="ap-close" id="closeAdmin">√ó</button></div><div class="ap-tabs"><button class="ap-tab active" data-tab="users">Users</button><button class="ap-tab" data-tab="mod">Moderate</button><button class="ap-tab" data-tab="troll">Effects</button><button class="ap-tab" data-tab="bans">Bans</button><button class="ap-tab" data-tab="settings">Settings</button><button class="ap-tab" data-tab="owner" id="ownerTab" style="display:none">üëë Owner</button></div><div class="ap-content"><div class="ap-section active" data-section="users" id="apUsers"></div><div class="ap-section" data-section="mod"><div class="form-group"><label class="form-label">Target User</label><select class="form-select" id="modUser"></select></div><div class="form-group"><label class="form-label">Action Type</label><select class="form-select" id="modAction"><option value="kick">Kick User</option><option value="timeout">Timeout</option><option value="mute">Mute</option><option value="ban">Ban</option><option value="warning">Send Warning</option></select></div><div class="form-group"><label class="form-label">Duration (seconds)</label><input type="number" class="form-input" id="modDur" value="60"></div><div class="form-group"><label class="form-label">Reason (optional)</label><input type="text" class="form-input" id="modReason" placeholder="Violation reason..."></div><div class="ban-type-selector" id="banTypeSelector" style="display:none"><button class="ban-type-btn" data-type="username">Username Only</button><button class="ban-type-btn selected" data-type="ip">IP Only</button><button class="ban-type-btn" data-type="both">Both</button></div><button class="btn btn-primary" id="execMod">Execute Action</button></div><div class="ap-section" data-section="troll"><div class="form-group"><label class="form-label">Target User</label><select class="form-select" id="trollUser"></select></div><div class="troll-grid"><button class="troll-btn warn" data-troll="spinScreen">üåÄ Spin</button><button class="troll-btn warn" data-troll="shakeScreen">üì≥ Shake</button><button class="troll-btn warn" data-troll="flipScreen">üôÉ Flip</button><button class="troll-btn warn" data-troll="invertColors">üé® Invert</button><button class="troll-btn" data-troll="emojiSpam">üòÇ Emoji</button><button class="troll-btn" data-troll="rainbow">üåà Rainbow</button><button class="troll-btn" data-troll="blur">üëì Blur</button><button class="troll-btn" data-troll="matrix">üíö Matrix</button><button class="troll-btn success" data-troll="confetti">üéâ Confetti</button><button class="troll-btn danger" data-troll="rickRoll">üéµ Rick</button><button class="troll-btn danger" data-troll="forceDisconnect">üîå DC</button><button class="troll-btn success" id="confettiAll">üéä All</button></div><div class="form-group"><label class="form-label">Server Broadcast</label><input type="text" class="form-input" id="broadcastMsg" placeholder="Announcement message..."></div><button class="btn btn-primary" id="sendBroadcast">üì¢ Broadcast to All</button></div><div class="ap-section" data-section="bans"><div class="form-label">Banned Usernames</div><div class="ban-list" id="bannedUsers"></div><div class="form-label">Banned IP Addresses</div><div class="ban-list" id="bannedIPs"></div><button class="btn btn-primary" id="refreshBans">üîÑ Refresh Lists</button></div><div class="ap-section" data-section="settings"><div class="form-group"><label class="form-label">Slow Mode Duration (seconds)</label><input type="number" class="form-input" id="slowDur" value="5"></div><div class="form-group"><label style="color:#dcddde;font-size:12px;cursor:pointer;display:flex;align-items:center;gap:8px"><input type="checkbox" id="slowEnabled"> Enable Slow Mode</label></div><button class="btn btn-primary" id="applySlowMode">Apply Slow Mode</button><div class="form-group" style="margin-top:16px"><label class="form-label">Clear Channel Messages</label><select class="form-select" id="clearChan"><option value="general">general</option><option value="gaming">gaming</option><option value="memes">memes</option></select></div><button class="btn btn-danger" id="clearChatBtn">üóëÔ∏è Clear Channel</button></div><div class="ap-section" data-section="owner"><div class="owner-section"><div class="section-title">üí∞ Coin Management</div><div class="form-group"><label class="form-label">Select User</label><select class="form-select" id="ownerUser"></select></div><div class="form-group"><label class="form-label">Amount</label><input type="number" class="form-input" id="ownerAmt" placeholder="Coin amount"></div><div class="owner-grid"><button class="owner-btn" id="ownerGive">üí∞ Give</button><button class="owner-btn" id="ownerTake">üí∏ Take</button><button class="owner-btn" id="ownerSet">üìù Set</button><button class="owner-btn" id="ownerReset">üîÑ Reset</button></div></div><div class="owner-section"><div class="section-title">üîÑ Advanced Coin Operations</div><div class="form-group"><label class="form-label">User 1</label><select class="form-select" id="swapU1"></select></div><div class="form-group"><label class="form-label">User 2</label><select class="form-select" id="swapU2"></select></div><button class="owner-btn" style="width:100%;margin-bottom:8px" id="ownerSwap">üîÑ Swap Coins</button><div class="form-group"><label class="form-label">Global Multiplier</label><input type="number" class="form-input" id="multAmt" placeholder="e.g., 2 or 0.5" step="0.1"></div><button class="owner-btn" style="width:100%" id="ownerMult">‚úñÔ∏è Multiply All Coins</button></div><div class="owner-section"><div class="section-title">üåç Server Actions</div><button class="owner-btn" style="width:100%;margin-bottom:6px;background:#3ba55d" id="ownerRainCoins">üåßÔ∏è Rain Coins (All Users)</button><button class="owner-btn" style="width:100%;margin-bottom:6px;background:#9b59b6" id="ownerFreezeEconomy">‚ùÑÔ∏è Freeze Economy</button><button class="owner-btn" style="width:100%;margin-bottom:6px;background:#f39c12" id="ownerDoubleEvent">‚ö° 2x Coins Event</button><button class="owner-btn" style="width:100%;background:#ed4245" id="ownerGlobalReset">‚ò¢Ô∏è GLOBAL RESET</button></div><div class="owner-section"><div class="section-title">üì¢ Announcements</div><input type="text" class="form-input" id="ownerAnnounce" placeholder="Persistent announcement..."><button class="owner-btn" style="width:100%;margin-top:6px;background:#5865f2" id="ownerAnnounceBtn">üì¢ Post Announcement</button></div></div></div></div>
<div class="container"><div class="sidebar"><div class="server-header">The Chet</div><div class="channels"><div class="channel-section"><div class="section-header">Channels</div><div class="channel" data-channel="announcements"><span class="channel-name">announcements</span><span class="unread-badge">0</span></div><div class="channel active" data-channel="general"><span class="channel-name">general</span><span class="unread-badge">0</span></div><div class="channel" data-channel="gaming"><span class="channel-name">gaming</span><span class="unread-badge">0</span></div><div class="channel" data-channel="memes"><span class="channel-name">memes</span><span class="unread-badge">0</span></div></div><div class="channel-section"><div class="section-header">Direct Messages</div><div id="dmList"></div></div></div><div class="user-area" id="userArea"><div class="user-avatar" id="myAvatar">U<div class="notif-dot" id="notifDot"></div><div class="avatar-badge owner" id="badgeOwner">üëë</div><div class="avatar-badge admin" id="badgeAdmin">‚ö°</div><div class="avatar-badge vip" id="badgeVip">‚≠ê</div></div><div class="user-display-name" id="myName">User</div><div class="conn-status" id="connStatus"></div></div></div><div class="main-content"><div class="chat-header"><div class="current-channel" id="curChan">general</div><div class="header-actions"><button class="casino-btn" id="openCasino">üé∞ Casino</button><div class="coins-display" id="coinsBox">üí∞ <span id="coinsCnt">0</span></div></div></div><div class="messages" id="msgArea"></div><div class="input-area"><div class="typing-indicator" id="typingInd"></div><div class="reply-bar" id="replyBar"><span class="reply-bar-text" id="replyText"></span><button class="reply-bar-close" id="cancelReply">√ó</button></div><div class="input-wrapper"><input type="text" class="msg-input" id="msgInput" placeholder="Message #general (try /help)" maxlength="2000"><button class="send-btn" id="sendBtn">Send</button></div></div></div><div class="sidebar right" id="rightSidebar"><div class="right-toggle" id="rightToggle">‚ñ∂</div><div class="server-header"><span>Online Users</span><span class="online-count" id="onlineCount">0</span></div><div class="users-section"><div class="role-header owner-header" id="ownerHeader" style="display:none">üëë Owners</div><div id="ownersList"></div><div class="role-header admin-header" id="adminHeader" style="display:none">‚ö° Admins</div><div id="adminsList"></div><div class="role-header vip-header" id="vipHeader" style="display:none">‚≠ê VIP</div><div id="vipsList"></div><div class="role-header guest-header" id="guestHeader" style="display:none">Users</div><div id="guestsList"></div></div></div></div>
<script>
const EMOJIS=['üëç','üëé','‚ù§Ô∏è','üòÇ','üòÆ','üò¢','üî•','üéâ','üëÄ','üíØ'];
let ws,connected=false,username='',uuid=null,isAdmin=false,isVIP=false,isOwner=false,coins=0,peace=false;
let curChan='general',chatType='channel',curDM=null,replyTo=null,selGame=null,selChoice=null,curGameId=null;
const messages={},dmMessages={},dmPartners={},users=[],unreadChannels={},unreadDMs={};
const $=id=>document.getElementById(id);
let hasUnread=false,isTabVisible=true,selectedBanType='ip';

document.addEventListener('visibilitychange',()=>{isTabVisible=!document.hidden;if(isTabVisible){clearFaviconNotif()}});

const HELP_COMMANDS=[
{name:'/help',desc:'Show this help menu'},
{name:'/daily',desc:'Claim 100 coins (24h cooldown)'},
{name:'/beg',desc:'Beg for coins (10s cooldown, 10% chance)'},
{name:'/work',desc:'Work for coins (30s cooldown)'},
{name:'/rob <user>',desc:'Rob someone (60s cooldown, 40% success)'},
{name:'/steal <user>',desc:'Steal coins (peace mode blocks)'},
{name:'/coinflip <amt> <heads/tails>',desc:'Flip a coin'},
{name:'/dice <amt> <odd/even>',desc:'Roll dice'},
{name:'/slots <amount>',desc:'Play slots'},
{name:'/blackjack <amount>',desc:'Play blackjack'},
{name:'/give <user> <amt>',desc:'Give coins to someone'},
{name:'/balance',desc:'Check your balance'},
{name:'/stats',desc:'View your stats'},
{name:'/leaderboard',desc:'Top 10 players'},
{name:'/peace',desc:'Toggle peace mode (blocks rob/steal)'},
{name:'/profile [user]',desc:'View profile'}
];

function updateFavicon(hasNotif){
const fav=$('favicon');
if(hasNotif){fav.href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üíÄ</text><circle cx='85' cy='15' r='15' fill='%23ed4245'/></svg>"}
else{fav.href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üíÄ</text></svg>"}
}

function showFaviconNotif(){if(!isTabVisible){hasUnread=true;updateFavicon(true);$('notifDot').classList.add('show')}}
function clearFaviconNotif(){hasUnread=false;updateFavicon(false);$('notifDot').classList.remove('show')}

function send(d){if(ws&&ws.readyState===1)ws.send(JSON.stringify(d))}
function notify(title,body,acts){
const n=document.createElement('div');n.className='notif';
n.innerHTML=`<div class="notif-title">${title}</div><div class="notif-body">${body}</div>${acts||''}`;
$('notifs').appendChild(n);
showFaviconNotif();
if(!acts)setTimeout(()=>n.remove(),4000);
return n;
}

function connect(){
const url=location.protocol==='https:'?`wss://${location.host}`:`ws://${location.hostname}:${location.port||3000}`;
ws=new WebSocket(url);
ws.onopen=()=>{
connected=true;$('connStatus').classList.add('online');$('sendBtn').disabled=false;
send({type:'join',username,uuid,adminPassword:(isAdmin||isOwner)?'classic-admin-76':undefined,vipPassword:isVIP?'very-important-person':undefined,ownerPassword:isOwner?'6shravan':undefined});
send({type:'getHistory',channel:curChan});
};
ws.onclose=()=>{connected=false;$('connStatus').classList.remove('online');$('sendBtn').disabled=true;setTimeout(connect,3000)};
ws.onmessage=e=>{try{handle(JSON.parse(e.data))}catch(er){console.error(er)}};
}

function handle(d){
const h={
joined:()=>{
if(d.uuid){uuid=d.uuid;localStorage.setItem('uuid',uuid)}
if(d.isAdmin){isAdmin=true;$('badgeAdmin').classList.add('show')}
if(d.isVIP){isVIP=true;$('badgeVip').classList.add('show')}
if(d.isOwner){isOwner=true;$('badgeOwner').classList.add('show');$('ownerTab').style.display='block'}
if(d.coins!==undefined){coins=d.coins;updCoins()}
if(d.peaceMode!==undefined){peace=d.peaceMode;updCoins()}
},
message:()=>{
if(!messages[d.message.channel])messages[d.message.channel]=[];
messages[d.message.channel].push(d.message);
if(d.message.channel===curChan&&chatType==='channel')render();
else{
unreadChannels[d.message.channel]=(unreadChannels[d.message.channel]||0)+1;
updateUnreadBadge(d.message.channel);
showFaviconNotif();
notify('üí¨ New Message',`#${d.message.channel}: ${d.message.author}: ${d.message.text.slice(0,50)}`);
}
},
history:()=>{messages[d.channel]=d.messages;if(d.channel===curChan&&chatType==='channel')render()},
userList:()=>{users.length=0;users.push(...d.users);updUsers()},
typing:()=>{if((d.isPrivate&&dmPartners[curDM]===d.username)||(!d.isPrivate&&d.channel===curChan)){$('typingInd').textContent=d.isTyping?`${d.username} is typing...`:''}},
privateChatRequest:()=>{
const n=notify('üí¨ DM Request',`${d.from} wants to chat`,`<div class="notif-actions"><button class="notif-btn notif-accept" data-a="y">Accept</button><button class="notif-btn notif-decline" data-a="n">Decline</button></div>`);
n.querySelector('[data-a="y"]').onclick=()=>{send({type:'privateChatResponse',from:d.from,accepted:true});n.remove()};
n.querySelector('[data-a="n"]').onclick=()=>{send({type:'privateChatResponse',from:d.from,accepted:false});n.remove()};
},
privateChatAccepted:()=>{dmPartners[d.chatId]=d.with;addDM(d.chatId,d.with);switchDM(d.chatId,d.with)},
privateChatRejected:()=>notify('‚ùå',`${d.by} declined`),
privateMessage:()=>{
if(!dmMessages[d.message.chatId])dmMessages[d.message.chatId]=[];
dmMessages[d.message.chatId].push(d.message);
if(d.message.chatId===curDM&&chatType==='dm')render();
else{
unreadDMs[d.message.chatId]=(unreadDMs[d.message.chatId]||0)+1;
updateDMBadge(d.message.chatId);
showFaviconNotif();
const partner=dmPartners[d.message.chatId];
notify('üí¨ New DM',`@${partner}: ${d.message.text.slice(0,50)}`);
}
},
privateHistory:()=>{dmMessages[d.chatId]=d.messages;if(d.chatId===curDM&&chatType==='dm')render()},
reactionUpdate:()=>{const arr=d.isPrivate?dmMessages[d.chatId]:messages[d.channel];const m=arr?.find(x=>x.id===d.messageId);if(m){m.reactions=d.reactions;render()}},
coinsUpdate:()=>{coins=d.coins;updCoins()},
peaceModeUpdate:()=>{peace=d.peaceMode;updCoins()},
leaderboard:()=>updLB(d.leaderboard),
gameBettingOpen:()=>{
if(d.player1===username||d.player2===username)return;
const n=notify(`üé≤ ${d.player1} vs ${d.player2}`,`${d.game} for ${d.wager}üí∞ - Bet now!`,`<div style="margin-top:8px"><select id="bp-${d.gameId}" style="padding:6px;background:#40444b;color:#fff;border:none;border-radius:4px"><option value="${d.player1}">${d.player1}</option><option value="${d.player2}">${d.player2}</option></select><input type="number" id="ba-${d.gameId}" placeholder="Amount" style="width:70px;padding:6px;margin:0 6px;background:#40444b;color:#fff;border:none;border-radius:4px"><button class="notif-btn notif-accept" style="padding:6px 12px" onclick="placeBet('${d.gameId}')">Bet</button></div>`);
setTimeout(()=>n.remove(),15000);
},
gameBettingClosed:()=>notify('üé≤','Betting closed!'),
gameChallenge:()=>{
const choices=d.game==='coinflip'?['heads','tails']:['odd','even'];
const opts=choices.filter(c=>c!==d.opponentChoice).map(c=>`<button class="notif-btn notif-accept" style="flex:1" onclick="acceptGame('${d.gameId}','${c}')">${c.toUpperCase()}</button>`).join('');
const n=notify('üéÆ Challenge!',`${d.from} challenges you to ${d.game} for ${d.wager}üí∞<br>They chose: <b>${d.opponentChoice}</b>`,`<div style="margin-top:8px"><div style="display:flex;gap:6px;margin-bottom:6px">${opts}</div><button class="notif-btn notif-decline" onclick="declineGame('${d.gameId}',this)">Decline</button></div>`);
n.id='gc-'+d.gameId;
},
gameReady:()=>{curGameId=d.gameId;$('gameVs').textContent=`${username} vs ${d.opponent}`;$('gameWager').textContent=`Wager: ${d.wager}üí∞`;$('gameAnim').textContent=d.game==='coinflip'?'ü™ô':'üé≤';$('gameAnim').style.animation='';$('gameResult').textContent='';$('gameResult').className='game-result';$('readyBtn').style.display='block';$('gameScreen').classList.add('show')},
gameResult:()=>notify('üéÆ',`${d.resultMsg} ${d.winner} wins ${d.wager}üí∞!`),
gameEnd:()=>{$('gameAnim').style.animation='';$('readyBtn').style.display='none';$('gameResult').textContent=d.isWinner?`üéâ YOU WON ${d.wager}üí∞!`:`üò¢ Lost ${d.wager}üí∞`;$('gameResult').className='game-result '+(d.isWinner?'win':'lose');setTimeout(()=>{$('gameScreen').classList.remove('show');curGameId=null},3000)},
kicked:()=>{alert(d.message);location.href=d.redirectUrl||'https://google.com'},
banned:()=>{alert(d.message);location.href='https://google.com'},
timedOut:()=>notify('‚è∞',d.message),
warning:()=>notify(`‚ö†Ô∏è Warning #${d.count}`,d.message),
broadcast:()=>notify('üì¢',d.message),
announcement:()=>{notify('üì¢',d.message.text);if(!messages.announcements)messages.announcements=[];messages.announcements.push(d.message);if(curChan==='announcements')render()},
adminActionSuccess:()=>notify('‚úÖ',d.message||'Done'),
error:()=>notify('‚ùå',d.message),
forceMute:()=>{notify('üîá',`Muted for ${d.duration}s`);$('msgInput').disabled=true;$('sendBtn').disabled=true;setTimeout(()=>{$('msgInput').disabled=false;$('sendBtn').disabled=!connected},d.duration*1000)},
banList:()=>{$('bannedUsers').innerHTML=d.bannedUsers.length?d.bannedUsers.map(u=>`<div class="ban-item"><span>${u}</span><button class="unban-btn" onclick="send({type:'adminUnban',username:'${u}'})">Unban</button></div>`).join(''):'<div class="empty">None</div>';$('bannedIPs').innerHTML=d.bannedIPs.length?d.bannedIPs.map(ip=>`<div class="ban-item"><span>${ip}</span><button class="unban-btn" onclick="send({type:'adminUnbanIP',ip:'${ip}'})">Unban</button></div>`).join(''):'<div class="empty">None</div>'},
chatCleared:()=>{if(messages[d.channel])messages[d.channel]=[];if(d.channel===curChan)render()},
messageDeleted:()=>{if(messages[d.channel]){messages[d.channel]=messages[d.channel].filter(m=>m.id!==d.messageId);if(d.channel===curChan)render()}},
showStealList:()=>send({type:'getStealableUsers'}),
stealableUsers:()=>{const t=prompt('Users:\n'+d.users.map(u=>`${u.username} (${u.coins}üí∞)`).join('\n')+'\n\nEnter name to steal:');if(t){$('msgInput').value='/steal '+t;sendMsg()}},
spinScreen:()=>{document.body.style.animation='spin 2s linear';setTimeout(()=>document.body.style.animation='',2000)},
shakeScreen:()=>{document.body.style.animation='shake .5s';setTimeout(()=>document.body.style.animation='',500)},
flipScreen:()=>{document.body.style.transform='rotate(180deg)';setTimeout(()=>document.body.style.transform='',5000)},
invertColors:()=>{document.body.style.filter='invert(1)';setTimeout(()=>document.body.style.filter='',5000)},
rainbow:()=>{document.body.style.animation='rainbow 2s infinite';setTimeout(()=>document.body.style.animation='',5000)},
blur:()=>{document.body.style.filter='blur(5px)';setTimeout(()=>document.body.style.filter='',5000)},
matrix:()=>{document.body.style.cssText='background:#000!important';setTimeout(()=>document.body.style.cssText='',5000)},
emojiSpam:()=>{for(let i=0;i<20;i++)setTimeout(()=>{const e=document.createElement('div');e.textContent=['üòÇ','üî•','üíÄ','üéâ'][Math.floor(Math.random()*4)];e.style.cssText=`position:fixed;font-size:48px;left:${Math.random()*100}vw;top:${Math.random()*100}vh;pointer-events:none;z-index:9999`;document.body.appendChild(e);setTimeout(()=>e.remove(),2000)},i*100)},
confetti:()=>{const cols=['#ff0','#f0f','#0ff','#f00','#0f0'];for(let i=0;i<50;i++)setTimeout(()=>{const c=document.createElement('div');c.className='confetti';c.style.cssText=`left:${Math.random()*100}%;top:-10px;background:${cols[Math.floor(Math.random()*5)]}`;document.body.appendChild(c);setTimeout(()=>c.remove(),3000)},i*40)},
rickRoll:()=>window.open('https://www.youtube.com/watch?v=dQw4w9WgXcQ','_blank'),
forceDisconnect:()=>{alert('Disconnected by admin');ws.close()}
};
if(h[d.type])h[d.type]();
}

function updCoins(){$('coinsCnt').textContent=coins;$('coinsBox').classList.toggle('peace',peace)}
function updLB(lb){$('leaderboard').innerHTML=lb.length?lb.map((u,i)=>`<div class="lb-item"><span class="lb-rank">#${i+1}</span><span class="lb-name">${u.username}</span><span class="lb-coins">${u.coins}üí∞</span></div>`).join(''):'<div class="empty">No data</div>'}

function updateUnreadBadge(channel){
const el=document.querySelector(`[data-channel="${channel}"]`);
if(!el)return;
const badge=el.querySelector('.unread-badge');
const count=unreadChannels[channel]||0;
if(badge){badge.textContent=count;el.classList.toggle('has-unread',count>0)}
}

function updateDMBadge(chatId){
const el=document.querySelector(`[data-dm="${chatId}"]`);
if(!el)return;
const count=unreadDMs[chatId]||0;
if(count>0){
let badge=el.querySelector('.dm-badge');
if(!badge){badge=document.createElement('span');badge.className='dm-badge';el.appendChild(badge)}
badge.textContent=count;
el.classList.add('has-unread');
}else{
const badge=el.querySelector('.dm-badge');
if(badge)badge.remove();
el.classList.remove('has-unread');
}
}

function updUsers(){
const ow=users.filter(u=>u.isOwner&&u.username!==username);
const ad=users.filter(u=>u.isAdmin&&!u.isOwner&&u.username!==username);
const vi=users.filter(u=>u.isVIP&&!u.isAdmin&&!u.isOwner&&u.username!==username);
const gu=users.filter(u=>!u.isVIP&&!u.isAdmin&&!u.isOwner&&u.username!==username);

const makeItem=(u)=>{
let roleIcon='';
let roleBadge='';
if(u.isOwner){roleIcon='üëë';roleBadge='<span class="role-badge owner">OWNER</span>'}
else if(u.isAdmin){roleIcon='‚ö°';roleBadge='<span class="role-badge admin">ADMIN</span>'}
else if(u.isVIP){roleIcon='‚≠ê';roleBadge='<span class="role-badge vip">VIP</span>'}
return `<div class="user-item"><span class="user-name">${roleIcon} ${u.username}${roleBadge}</span><button class="dm-btn" onclick="reqDM('${u.username}')">DM</button></div>`;
};

$('ownerHeader').style.display=ow.length?'block':'none';
$('ownersList').innerHTML=ow.map(makeItem).join('');

$('adminHeader').style.display=ad.length?'block':'none';
$('adminsList').innerHTML=ad.map(makeItem).join('');

$('vipHeader').style.display=vi.length?'block':'none';
$('vipsList').innerHTML=vi.map(makeItem).join('');

$('guestHeader').style.display=gu.length?'block':'none';
$('guestsList').innerHTML=gu.map(makeItem).join('');

$('onlineCount').textContent=users.length-1;
updSelects();
}

function updSelects(){
const others=users.filter(u=>u.username!==username);
const opts='<option value="">-- Select User --</option>'+others.map(u=>`<option value="${u.username}">${u.username}</option>`).join('');
['modUser','trollUser','ownerUser','swapU1','swapU2','challengeTarget'].forEach(id=>{const el=$(id);if(el)el.innerHTML=opts});
$('apUsers').innerHTML=others.length?others.map(u=>`<div class="ap-user"><div class="ap-user-info"><div class="ap-user-avatar">${u.username[0].toUpperCase()}</div><div class="ap-user-name">${u.username}${u.isOwner?' <span class="role-badge owner">OWNER</span>':u.isAdmin?' <span class="role-badge admin">ADMIN</span>':u.isVIP?' <span class="role-badge vip">VIP</span>':''}</div></div><div class="ap-user-actions"><button class="ap-btn ap-btn-kick" onclick="send({type:'adminKick',targetUsername:'${u.username}'})">Kick</button><button class="ap-btn ap-btn-to" onclick="send({type:'adminTimeout',targetUsername:'${u.username}',duration:60})">TO</button><button class="ap-btn ap-btn-mute" onclick="send({type:'adminForceMute',targetUsername:'${u.username}',duration:60})">Mute</button><button class="ap-btn ap-btn-ban" onclick="quickBan('${u.username}')">Ban</button></div></div>`).join(''):'<div class="empty">No other users online</div>';
}

function quickBan(username){
if(confirm(`Ban ${username}?`)){
send({type:'adminBan',targetUsername:username,banType:selectedBanType});
}
}

function reqDM(u){send({type:'privateChatRequest',targetUsername:u})}
function addDM(id,name){
if(document.querySelector(`[data-dm="${id}"]`))return;
const el=document.createElement('div');el.className='channel private';el.dataset.dm=id;
el.innerHTML=`<span class="channel-name">${name}</span><button class="close-dm">√ó</button>`;
el.querySelector('.close-dm').onclick=e=>{e.stopPropagation();el.remove();delete dmPartners[id];delete dmMessages[id];delete unreadDMs[id];if(curDM===id)switchChan('general')};
el.onclick=()=>switchDM(id,name);
$('dmList').appendChild(el);
}

function switchChan(ch){
chatType='channel';curDM=null;curChan=ch;
$('curChan').textContent=ch;$('curChan').classList.remove('private');
$('msgInput').placeholder=`Message #${ch} (try /help)`;
document.querySelectorAll('.channel').forEach(c=>{c.classList.remove('active');if(c.dataset.channel===ch)c.classList.add('active')});
if(!messages[ch])send({type:'getHistory',channel:ch});else render();
unreadChannels[ch]=0;
updateUnreadBadge(ch);
clearFaviconNotif();
}

function switchDM(id,name){
chatType='dm';curDM=id;
$('curChan').textContent=name;$('curChan').classList.add('private');
$('msgInput').placeholder=`Message @${name}`;
document.querySelectorAll('.channel').forEach(c=>c.classList.remove('active'));
document.querySelector(`[data-dm="${id}"]`)?.classList.add('active');
if(!dmMessages[id])send({type:'getPrivateHistory',chatId:id});else render();
unreadDMs[id]=0;
updateDMBadge(id);
clearFaviconNotif();
}

function render(){
const arr=chatType==='dm'?dmMessages[curDM]||[]:messages[curChan]||[];
$('msgArea').innerHTML=arr.map(m=>{
const authorClass=m.isOwner?'owner':m.isAdmin?'admin':m.isVIP?'vip':'normal';
const badge=m.isOwner?'<span class="role-badge owner">OWNER</span>':m.isAdmin?'<span class="role-badge admin">ADMIN</span>':m.isVIP?'<span class="role-badge vip">VIP</span>':'';
const replyHtml=m.replyTo?`<div class="msg-reply"><span class="msg-reply-author">‚Ü© ${m.replyTo.author}:</span> ${m.replyTo.text}</div>`:'';
let reactHtml='';
if(m.reactions&&Object.keys(m.reactions).length){
reactHtml='<div class="reactions">'+Object.entries(m.reactions).map(([e,u])=>`<div class="reaction${u.includes(username)?' active':''}" onclick="${u.includes(username)?'remReact':'addReact'}('${m.id}','${e}')">${e}<span class="reaction-count">${u.length}</span></div>`).join('')+'</div>';
}
const adminBtns=(isAdmin||isOwner)&&!m.isSystem?`<button class="msg-action" onclick="send({type:'adminDeleteMessage',messageId:'${m.id}',channel:'${m.channel||curChan}'})">üóëÔ∏è</button>`:'';
return `<div class="message" data-id="${m.id}"><div class="msg-avatar">${m.author[0].toUpperCase()}</div><div class="msg-content">${replyHtml}<div class="msg-header"><span class="msg-author ${authorClass}">${m.author}</span>${badge}<span class="msg-time">${new Date(m.timestamp).toLocaleTimeString().slice(0,5)}</span></div><div class="msg-text">${esc(m.text)}</div>${reactHtml}</div><div class="msg-actions"><button class="msg-action" onclick='setReply(${JSON.stringify({id:m.id,author:m.author,text:m.text.slice(0,50)}).replace(/'/g,"&#39;")})'>‚Ü©</button><button class="msg-action" onclick="toggleEmoji('${m.id}')">üòÄ</button>${adminBtns}</div><div class="emoji-picker" id="ep-${m.id}">${EMOJIS.map(e=>`<button onclick="addReact('${m.id}','${e}');toggleEmoji('${m.id}')">${e}</button>`).join('')}</div></div>`;
}).join('');
$('msgArea').scrollTop=$('msgArea').scrollHeight;
}

function esc(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML}
function toggleEmoji(id){document.querySelectorAll('.emoji-picker').forEach(p=>p.classList.remove('show'));$('ep-'+id)?.classList.toggle('show')}
function addReact(id,e){send({type:'addReaction',messageId:id,emoji:e,channel:curChan,isPrivate:chatType==='dm',chatId:curDM})}
function remReact(id,e){send({type:'removeReaction',messageId:id,emoji:e,channel:curChan,isPrivate:chatType==='dm',chatId:curDM})}
function setReply(r){replyTo=r;$('replyText').innerHTML=`Replying to <b>${r.author}</b>`;$('replyBar').classList.add('show');$('msgInput').focus()}
function clearReply(){replyTo=null;$('replyBar').classList.remove('show')}

function sendMsg(){
const t=$('msgInput').value.trim();
if(!t||!connected)return;

if(t.startsWith('/')){
const cmd=t.split(' ')[0].toLowerCase();
if(cmd==='/help'){
showHelp();
$('msgInput').value='';
return;
}
}

if(chatType==='dm')send({type:'privateMessage',chatId:curDM,text:t,targetUsername:dmPartners[curDM],replyTo});
else send({type:'message',channel:curChan,text:t,replyTo});
$('msgInput').value='';
clearReply();
}

function showHelp(){
const html=HELP_COMMANDS.map(c=>`<div class="help-command"><div class="help-command-name">${c.name}</div><div class="help-command-desc">${c.desc}</div></div>`).join('');
$('helpContent').innerHTML=html;
$('helpModal').classList.add('show');
}

function placeBet(gid){
const on=document.getElementById('bp-'+gid)?.value;
const amt=parseInt(document.getElementById('ba-'+gid)?.value);
if(!on||!amt||amt<1)return notify('‚ùå','Invalid bet');
send({type:'placeBet',gameId:gid,betOn:on,amount:amt});
}

function acceptGame(gid,choice){document.getElementById('gc-'+gid)?.remove();send({type:'challengeResponse',gameId:gid,accepted:true,choice})}
function declineGame(gid,el){el.closest('.notif')?.remove();send({type:'challengeResponse',gameId:gid,accepted:false})}

document.addEventListener('DOMContentLoaded',()=>{
$('loginBtn').onclick=tryLogin;
$('guestLogin').onclick=()=>{tryLogin('classic')};
$('pwdInput').onkeypress=e=>{if(e.key==='Enter')tryLogin()};

function tryLogin(guestMode){
const p=guestMode||$('pwdInput').value.trim();
if(p==='6shravan'){isAdmin=true;isOwner=true}
else if(p==='classic-admin-76'){isAdmin=true}
else if(p==='very-important-person'){isVIP=true}
else if(p==='classic'||guestMode==='classic'){}
else{$('loginError').textContent='Wrong password';return}

let u=prompt('Enter username (max 30 chars):','User')||'User';
username=u.slice(0,30).trim()||'User';

$('myName').textContent=username;
$('myAvatar').childNodes[0].textContent=username[0].toUpperCase();

if(isOwner)$('badgeOwner').classList.add('show');
else if(isAdmin)$('badgeAdmin').classList.add('show');
else if(isVIP)$('badgeVip').classList.add('show');
if(isOwner)$('ownerTab').style.display='block';

uuid=localStorage.getItem('uuid')||null;
$('loginOverlay').style.display='none';
connect();
}

$('sendBtn').onclick=sendMsg;
$('msgInput').onkeypress=e=>{if(e.key==='Enter')sendMsg()};
$('cancelReply').onclick=clearReply;

document.querySelectorAll('.channel[data-channel]').forEach(c=>{c.onclick=()=>switchChan(c.dataset.channel)});

$('openCasino').onclick=()=>{$('casinoModal').classList.add('show');send({type:'getLeaderboard'});updSelects()};
$('closeCasino').onclick=()=>{$('casinoModal').classList.remove('show');selGame=null;selChoice=null;document.querySelectorAll('.game-card').forEach(c=>c.classList.remove('selected'));$('choiceArea').style.display='none'};

$('closeHelp').onclick=()=>$('helpModal').classList.remove('show');

document.querySelectorAll('.game-card').forEach(c=>{
c.onclick=()=>{
document.querySelectorAll('.game-card').forEach(x=>x.classList.remove('selected'));
c.classList.add('selected');
selGame=c.dataset.game;selChoice=null;
const choices=selGame==='coinflip'?['heads','tails']:['odd','even'];
$('choiceBtns').innerHTML=choices.map(ch=>`<button class="choice-btn" data-choice="${ch}">${ch.toUpperCase()}</button>`).join('');
$('choiceArea').style.display='block';
document.querySelectorAll('.choice-btn').forEach(b=>{b.onclick=()=>{document.querySelectorAll('.choice-btn').forEach(x=>x.classList.remove('selected'));b.classList.add('selected');selChoice=b.dataset.choice}});
}
});

$('sendChallengeBtn').onclick=()=>{
const target=$('challengeTarget').value;
const wager=parseInt($('wagerAmt').value);
if(!target)return notify('‚ùå','Select a player');
if(!selGame)return notify('‚ùå','Select a game');
if(!selChoice)return notify('‚ùå','Make your choice');
if(!wager||wager<1)return notify('‚ùå','Enter valid wager');
if(wager>coins)return notify('‚ùå','Not enough coins');
send({type:'challengeUser',targetUsername:target,game:selGame,wager,choice:selChoice});
$('casinoModal').classList.remove('show');
};

$('readyBtn').onclick=()=>{send({type:'playerChoice',gameId:curGameId});$('readyBtn').style.display='none';$('gameAnim').style.animation='spin 1s linear infinite'};

$('userArea').onclick=()=>{
clearFaviconNotif();
if(isAdmin||isOwner){$('adminPanel').classList.toggle('show');updSelects();send({type:'adminGetBanList'})}
};
$('closeAdmin').onclick=()=>$('adminPanel').classList.remove('show');

$('rightToggle').onclick=()=>{
$('rightSidebar').classList.toggle('collapsed');
$('rightToggle').textContent=$('rightSidebar').classList.contains('collapsed')?'‚óÄ':'‚ñ∂';
};

document.querySelectorAll('.ap-tab').forEach(tab=>{
tab.onclick=()=>{
document.querySelectorAll('.ap-tab').forEach(t=>t.classList.remove('active'));
document.querySelectorAll('.ap-section').forEach(s=>s.classList.remove('active'));
tab.classList.add('active');
const sec=document.querySelector(`.ap-section[data-section="${tab.dataset.tab}"]`);
if(sec)sec.classList.add('active');
}
});

document.querySelectorAll('.ban-type-btn').forEach(btn=>{
btn.onclick=()=>{
document.querySelectorAll('.ban-type-btn').forEach(b=>b.classList.remove('selected'));
btn.classList.add('selected');
selectedBanType=btn.dataset.type;
}
});

$('modAction').onchange=()=>{
const action=$('modAction').value;
$('banTypeSelector').style.display=action==='ban'?'flex':'none';
};

$('execMod').onclick=()=>{
const u=$('modUser').value,a=$('modAction').value,d=parseInt($('modDur').value)||60,r=$('modReason').value;
if(!u)return notify('‚ùå','Select user');
if(a==='kick')send({type:'adminKick',targetUsername:u,reason:r});
else if(a==='timeout')send({type:'adminTimeout',targetUsername:u,duration:d,reason:r});
else if(a==='mute')send({type:'adminForceMute',targetUsername:u,duration:d});
else if(a==='ban')send({type:'adminBan',targetUsername:u,banType:selectedBanType,reason:r});
else if(a==='warning')send({type:'adminWarning',targetUsername:u,reason:r||'Warning'});
};

document.querySelectorAll('[data-troll]').forEach(b=>{
b.onclick=()=>{
const u=$('trollUser').value;if(!u)return notify('‚ùå','Select user');
const t=b.dataset.troll;
send({type:'admin'+t.charAt(0).toUpperCase()+t.slice(1),targetUsername:u});
}
});

$('confettiAll').onclick=()=>send({type:'adminConfetti'});
$('sendBroadcast').onclick=()=>{const m=$('broadcastMsg').value;if(m){send({type:'adminBroadcast',message:m});$('broadcastMsg').value=''}};
$('refreshBans').onclick=()=>send({type:'adminGetBanList'});
$('applySlowMode').onclick=()=>send({type:'adminSlowMode',enabled:$('slowEnabled').checked,duration:parseInt($('slowDur').value)||5});
$('clearChatBtn').onclick=()=>{if(confirm('Clear chat?'))send({type:'adminClearChat',channel:$('clearChan').value})};

$('ownerGive').onclick=()=>{const u=$('ownerUser').value,a=parseInt($('ownerAmt').value);if(u&&a)send({type:'ownerGiveCoins',targetUsername:u,amount:a})};
$('ownerTake').onclick=()=>{const u=$('ownerUser').value,a=parseInt($('ownerAmt').value);if(u&&a)send({type:'ownerTakeCoins',targetUsername:u,amount:a})};
$('ownerSet').onclick=()=>{const u=$('ownerUser').value,a=parseInt($('ownerAmt').value);if(u&&a!==undefined)send({type:'ownerSetCoins',targetUsername:u,amount:a})};
$('ownerReset').onclick=()=>{const u=$('ownerUser').value;if(u&&confirm('Reset '+u+'?'))send({type:'ownerResetUser',targetUsername:u})};
$('ownerSwap').onclick=()=>{const u1=$('swapU1').value,u2=$('swapU2').value;if(u1&&u2&&u1!==u2)send({type:'ownerSwapCoins',user1:u1,user2:u2})};
$('ownerMult').onclick=()=>{const m=parseFloat($('multAmt').value);if(m&&m>0&&confirm('Multiply all by '+m+'?'))send({type:'ownerMultiplyCoins',multiplier:m})};
$('ownerGlobalReset').onclick=()=>{if(confirm('RESET ALL DATA?'))send({type:'ownerGlobalReset'})};
$('ownerAnnounceBtn').onclick=()=>{const t=$('ownerAnnounce').value;if(t){send({type:'ownerAnnouncement',text:t});$('ownerAnnounce').value=''}};
$('ownerRainCoins').onclick=()=>{const amt=prompt('Rain amount per user:');if(amt&&!isNaN(amt))send({type:'ownerRainCoins',amount:parseInt(amt)})};
$('ownerFreezeEconomy').onclick=()=>{if(confirm('Freeze economy?'))send({type:'ownerFreezeEconomy'})};
$('ownerDoubleEvent').onclick=()=>{const dur=prompt('Duration in minutes:');if(dur&&!isNaN(dur))send({type:'ownerDoubleEvent',duration:parseInt(dur)})};

document.onclick=e=>{if(!e.target.closest('.emoji-picker')&&!e.target.closest('.msg-action'))document.querySelectorAll('.emoji-picker').forEach(p=>p.classList.remove('show'))};

$('casinoModal').onclick=e=>{if(e.target===$('casinoModal'))$('casinoModal').classList.remove('show')};
$('helpModal').onclick=e=>{if(e.target===$('helpModal'))$('helpModal').classList.remove('show')};
});
</script>
</body>
</html>
